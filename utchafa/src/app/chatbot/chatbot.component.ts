import { Component } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { NavComponent } from "../nav/nav.component";

@Component({
  selector: 'app-chatbot',
  standalone: true,
  imports: [CommonModule, FormsModule, NavComponent],
  templateUrl: './chatbot.component.html',
  styleUrls: ['./chatbot.component.css']
})
export class ChatbotComponent {
  mensajes: { texto: string, tipo: 'usuario' | 'bot' }[] = [
    { texto: 'Â¡Hola! Â¿En quÃ© puedo ayudarte?', tipo: 'bot' }
  ];
  mostrarOpciones: boolean = true;

  enviarMensaje(pregunta: string) {
    this.mensajes.push({ texto: pregunta, tipo: 'usuario' });
    this.mostrarOpciones = false;

    const respuesta = this.obtenerRespuesta(pregunta);

    setTimeout(() => {
      this.mensajes.push({ texto: respuesta, tipo: 'bot' });
      this.mostrarOpciones = true;
      setTimeout(() => this.scrollAlFinal(), 100);
    }, 500);
  }

  obtenerRespuesta(pregunta: string): string {
    switch (pregunta) {
      case 'Â¿Para quÃ© sirve esto?':
        return 'Esta secciÃ³n te permite hablar con un asistente automÃ¡tico para resolver tus dudas.';
      case 'Â¿CÃ³mo agrego una tarea?':
        return 'Ve al menÃº "Crear Tareas" (â•) y llena el formulario con la materia, nombre y fecha.';
      case 'Â¿CÃ³mo busco una tarea?':
        return 'En la secciÃ³n de Tareas ğŸ“‹ usa el campo de bÃºsqueda o los filtros de materia y fecha.';
     case 'Â¿CÃ³mo elimino una tarea?':
       return 'En cada tarea habra un icono de papelera, usalo para eliminar la tarea requerida.';
      default:
        return 'Lo siento, no entendÃ­ tu pregunta. Intenta con una opciÃ³n del menÃº.';
    }
  }

  scrollAlFinal() {
    const chatContainer = document.querySelector('.chat-mensajes');
    if (chatContainer) {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }
  }
}
